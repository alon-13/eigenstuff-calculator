<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Eigenstuff Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h2>Eigen-stuff Calculator</h2>
    <p>This calculator finds eigenvalues and basis vectors of a square matrix.</p>

    <p>Select Size (n x n): 
        <select id="size" onchange="createGrid()">
            <option value="2">2x2</option>
            <option value="3">3x3</option>
            <option value="4">4x4</option>
            <option value="5">5x5</option>
        </select>
    </p>

    <div id="matrix-container" class="matrix-grid"></div>
    <button onclick="calculate()">Compute</button>

    <div id="results"></div>

    <div class="reference-card">
        <img src="{{ url_for('static', filename='jp.jpg') }}" alt="Professor">
        <h4>Video Reference</h4>
        <p>Math 206 | Eigenvalues and Eigenvectors</p>
        <a href="https://youtu.be/ElUQ6I8eDj4" target="_blank">Watch Tutorial</a>
    </div>

    <footer id="footer">
        <div class="footer-content">
            <div class="footerBox">
                <h3>About us</h3>
                <p>Group 9 | BSCS 2-3</p>
            </div>
        </div>
    </footer>

    <script>
        function createGrid() {
            const size = document.getElementById('size').value;
            const container = document.getElementById('matrix-container');
            container.innerHTML = '';
            container.style.gridTemplateColumns = `repeat(${size}, 70px)`;

            for (let i = 0; i < size * size; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.value = '0';
                input.step = 'any';
                input.className = 'matrix-input';
                container.appendChild(input);
            }
        }

        async function calculate() {
            const size = parseInt(document.getElementById('size').value);
            const inputs = document.querySelectorAll('.matrix-input');
            const matrix = [];
            for (let i = 0; i < size; i++) {
                const row = [];
                for (let j = 0; j < size; j++) {
                    row.push(parseFloat(inputs[i * size + j].value) || 0);
                }
                matrix.push(row);
            }

            try {
                const response = await fetch('/compute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ matrix })
                });

                if (!response.ok) throw new Error('Server Error');

                const data = await response.json();
                if (data.error) throw new Error(data.error);

                displayResults(data.results);
            } catch (err) {
                alert("Error: " + err.message);
            }
        }

        function displayResults(results) {
            const div = document.getElementById('results');
            div.innerHTML = '<h3>Results:</h3>';
            
            if (!results || results.length === 0) {
                div.innerHTML += '<p>No results found.</p>';
                return;
            }

            results.forEach((item, index) => {
                // Join basis vectors with commas and wrap in brackets
                let basisHTML = item.basis.map(vec => `[${vec.join(', ')}]`).join(' , ');
                
                div.innerHTML += `
                    <div class="result-item">
                        <strong>Eigenvalue (Î»${index + 1}):</strong> ${item.eigenvalue} <br>
                        <strong>Basis for Eigenspace:</strong> { ${basisHTML} }
                    </div>`;
            });
        }

        window.addEventListener('DOMContentLoaded', createGrid);
    </script>
</body>
</html>
